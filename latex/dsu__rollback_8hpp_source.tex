\doxysection{dsu\+\_\+rollback.\+hpp}
\hypertarget{dsu__rollback_8hpp_source}{}\label{dsu__rollback_8hpp_source}\index{graph/dsu\_rollback.hpp@{graph/dsu\_rollback.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#include"{}../../kyopro\_library/template.hpp"{}}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00004\ \textcolor{keyword}{struct\ }DsuRollback\ \{}
\DoxyCodeLine{00005\ \ \ \ \ DsuRollback()=\textcolor{keywordflow}{default};}
\DoxyCodeLine{00006\ }
\DoxyCodeLine{00008\ \ \ \ \ \mbox{\hyperlink{struct_dsu_rollback_ad42c892c309ec0aa491c70bec3d58779}{DsuRollback}}(\textcolor{keywordtype}{int}\ n)\ \{}
\DoxyCodeLine{00009\ \ \ \ \ \ \ \ \ par=VI(n);\ iota(ALL(par),0);}
\DoxyCodeLine{00010\ \ \ \ \ \ \ \ \ sz=VI(n,1);}
\DoxyCodeLine{00011\ \ \ \ \ \ \ \ \ forest\_count=n;}
\DoxyCodeLine{00012\ \ \ \ \ \}}
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00015\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{struct_dsu_rollback_ac2028d09c590bdde38b2669f19728452}{find}}(\textcolor{keywordtype}{int}\ x)\ \{}
\DoxyCodeLine{00016\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(par[x]==x)\ \textcolor{keywordflow}{return}\ x;}
\DoxyCodeLine{00017\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{struct_dsu_rollback_ac2028d09c590bdde38b2669f19728452}{find}}(par[x]);}
\DoxyCodeLine{00018\ \ \ \ \ \}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00022\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{struct_dsu_rollback_a103be2aa1ff86601ef80cf051c3d566f}{merge}}(\textcolor{keywordtype}{int}\ x,\ \textcolor{keywordtype}{int}\ y)\ \{}
\DoxyCodeLine{00023\ \ \ \ \ \ \ \ \ x=\mbox{\hyperlink{struct_dsu_rollback_ac2028d09c590bdde38b2669f19728452}{find}}(x);\ y=\mbox{\hyperlink{struct_dsu_rollback_ac2028d09c590bdde38b2669f19728452}{find}}(y);}
\DoxyCodeLine{00024\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(x==y)\ \{}
\DoxyCodeLine{00025\ \ \ \ \ \ \ \ \ \ \ \ \ history.push\_back(\{x,-\/1,-\/1,-\/1\});}
\DoxyCodeLine{00026\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00027\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00028\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(sz[x]<sz[y])\ swap(x,y);}
\DoxyCodeLine{00029\ \ \ \ \ \ \ \ \ history.push\_back(\{x,y,sz[x],sz[y]\});}
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ par[y]=x;\ sz[x]+=sz[y];}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ forest\_count-\/-\/;}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00033\ \ \ \ \ \}}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00036\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_dsu_rollback_a576e5300d28f07244d0548cd2e98b052}{undo}}()\ \{}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(history.empty())\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}[x,y,szx,szy]=history.back();}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ history.pop\_back();}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(y==-\/1)\textcolor{keywordflow}{return};}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ par[y]=y;\ sz[x]=szx;\ sz[y]=szy;}
\DoxyCodeLine{00042\ \ \ \ \ \}}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00045\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_dsu_rollback_aa0ce04a8aaf999bda7719d681775505d}{snapshot}}()\ \{\ history.clear();\ \}}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_dsu_rollback_a7c33fb0f4e5b0f804b937ab4edb7a5ea}{rollback}}()\ \{\ \textcolor{keywordflow}{while}(!history.empty())\ \mbox{\hyperlink{struct_dsu_rollback_a576e5300d28f07244d0548cd2e98b052}{undo}}();\ \}}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{struct_dsu_rollback_ade29264c1fbd5b5bfdaefe918c9d6163}{size}}(\textcolor{keywordtype}{int}\ x)\ \{\ \textcolor{keywordflow}{return}\ sz[\mbox{\hyperlink{struct_dsu_rollback_ac2028d09c590bdde38b2669f19728452}{find}}(x)];\ \}}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{struct_dsu_rollback_a954350180a0b6956d0661419b2f764f6}{same}}(\textcolor{keywordtype}{int}\ x,\ \textcolor{keywordtype}{int}\ y)\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{struct_dsu_rollback_ac2028d09c590bdde38b2669f19728452}{find}}(x)==\mbox{\hyperlink{struct_dsu_rollback_ac2028d09c590bdde38b2669f19728452}{find}}(y);\ \}}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{struct_dsu_rollback_ada87b7194225ccb7dccb62080069bac6}{count}}()\ \{\ \textcolor{keywordflow}{return}\ forest\_count;\ \}}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00060\ \ \ \ \ VVI\ \mbox{\hyperlink{struct_dsu_rollback_aad21b3281d43bc47b352d86f880b3462}{groups}}()\ \{}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ n=par.size();}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ VVI\ ret(n);}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ REP(i,n)\ ret[\mbox{\hyperlink{struct_dsu_rollback_ac2028d09c590bdde38b2669f19728452}{find}}(i)].push\_back(i);}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ ret.erase(remove\_if(ALL(ret),[\&](\textcolor{keyword}{const}\ VI\&\ v)\ \{\ \textcolor{keywordflow}{return}\ v.empty();\ \}),ret.end());}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ret;}
\DoxyCodeLine{00066\ \ \ \ \ \}}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00069\ \ \ \ \ VI\ par,sz;}
\DoxyCodeLine{00070\ \ \ \ \ vector<tuple<int,int,int,int>>\ history;}
\DoxyCodeLine{00071\ \ \ \ \ \textcolor{keywordtype}{int}\ forest\_count;}
\DoxyCodeLine{00072\ \};}

\end{DoxyCode}
